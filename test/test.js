
var xmlCrypto = require('xml-crypto');
var FileKeyInfo = require('xml-crypto').FileKeyInfo;
var xpath = xmlCrypto.xpath;
var xmldom = require('xmldom');
var fs = require('fs');


let res = new Buffer('PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHNhbWwycDpSZXNwb25zZSBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9pbnRlbnNlLWhvbGxvd3MtNjA5MTAuaGVyb2t1YXBwLmNvbS9sb2dpbi9jYWxsYmFjayIgSUQ9Il8wY2E5M2MxYmYxZmVmNThlMmE3OTIwYmFkZjgyOGRjNSIgSW5SZXNwb25zZVRvPSJfNTA5ZWU1NWJjMTlkNThkNTkwZWIiIElzc3VlSW5zdGFudD0iMjAxOC0wMi0yMlQxMToxNDo0Ni4zODVaIiBWZXJzaW9uPSIyLjAiIHhtbG5zOnNhbWwycD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIj48c2FtbDI6SXNzdWVyIHhtbG5zOnNhbWwyPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj51cm46bWFjZTprdWxldXZlbi5iZTprdWxhc3NvYzprdWxldXZlbi5iZTwvc2FtbDI6SXNzdWVyPjxkczpTaWduYXR1cmUgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPgo8ZHM6U2lnbmVkSW5mbz4KPGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KPGRzOlNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZHNpZy1tb3JlI3JzYS1zaGEyNTYiLz4KPGRzOlJlZmVyZW5jZSBVUkk9IiNfMGNhOTNjMWJmMWZlZjU4ZTJhNzkyMGJhZGY4MjhkYzUiPgo8ZHM6VHJhbnNmb3Jtcz4KPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8+CjxkczpUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz4KPC9kczpUcmFuc2Zvcm1zPgo8ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8+CjxkczpEaWdlc3RWYWx1ZT5hQzA2cTZvUXNENjlaYitnVEhiWDIzd1VQNFd4dEhpUkY3a3RWdEtXRnpJPTwvZHM6RGlnZXN0VmFsdWU+CjwvZHM6UmVmZXJlbmNlPgo8L2RzOlNpZ25lZEluZm8+CjxkczpTaWduYXR1cmVWYWx1ZT4Ka1BwazdQSjkrY1AxTlhVTStlQktKa280NWk3Y1FKaGpCM1dXcVZuNDQza3czM3RTbFVrZFZuR0RERXB2dzg3ampNMHZ4UXMrWkdCTgpTM216VkpBNDMydGdEaHJvRW9tZ2lMNXBZSmxjczhkNWlBVTIrb2R1YVRuMHQvbjNOcTFtRUdCQmtNMnUxWUJCbXdVNkszVHQ3ZnNYCmpNbytlVXV5Y2VFS1pJZ2hxU2JOM1JhUVhCZldnNVFPR0R3NVFPa0syYURpN3pVNUkwaWxoWTVsdmRSSjVYMjI2aUxpcjBYS0pXOG0KVnJWUXhteVI2ZG13cFNFMVhnd3dSYUd4dEtoSkNBbDlHejZkUWJDd21DaGU5dVZlL0RDUHR0bitwQzY4QVl1TTZiSHVRbFU3VHptawozcFQ5K3owSzdqZ3paMHplc0FuZ2Q2UFFKV2xZa3FNNU1Fa0F0UT09CjwvZHM6U2lnbmF0dXJlVmFsdWU+CjxkczpLZXlJbmZvPjxkczpYNTA5RGF0YT48ZHM6WDUwOUNlcnRpZmljYXRlPk1JSURKekNDQWcrZ0F3SUJBZ0lVSkNrYUNMalBaZXZRZGJGYnlWL2FYOCtPYmZFd0RRWUpLb1pJaHZjTkFRRUZCUUF3R2pFWU1CWUcKQTFVRUF4TVBhV1J3TG10MWJHVjFkbVZ1TG1KbE1CNFhEVEV3TVRJd05qRXdNelkxTUZvWERUTXdNVEl3TmpFd016WTFNRm93R2pFWQpNQllHQTFVRUF4TVBhV1J3TG10MWJHVjFkbVZ1TG1KbE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCm9JWWEyRnhoSWZKN1N5MVJoV1RtVU9iR1VKUk9Xa3lSdVE4Y29sTmFnZDdMZ3RtVjFRTXR6TzdaQnJ6VXRKWXRsNjVKSmRHYTBiTjMKazJVb3RwdkIycXU3N244Z0NlbkZyMlFnT3hiZis3dWFkVmt4QVlhb3cwR0ExdTNhOWM0VGFIbjRZOFdhelIxU04zODZWS0d3WmNLRQpHR3NWS1duQzNnWEdMYXIycDFPcWQ2OWw2OG5TWFE5OE82R2dtR2JuRFZiTi9WZ05JMlZxZTVkcHU0dEFRUW9INmdQSEdQbDR4VGVmCmZBSS9WY3k3T3ZlQUVYbHoxbkdUeEpsd1o5LytSbUVWOHViNTUzWlllb2phY2VNcXJIRFNwa3p1ZDhmd1dzaWZqZFpTN2pmeEZ1aGwKYmlQaDY3YWE0eTFqc2tHbXZpV09FTkNOWlUyNDZUeVB1U0U5blFJREFRQUJvMlV3WXpCQ0JnTlZIUkVFT3pBNWdnOXBaSEF1YTNWcwpaWFYyWlc0dVltV0dKbWgwZEhCek9pOHZhV1J3TG10MWJHVjFkbVZ1TG1KbEwybGtjQzl6YUdsaVltOXNaWFJvTUIwR0ExVWREZ1FXCkJCUTNXcTNqS296enUrblJxUEFtbGxXai9jQlZBakFOQmdrcWhraUc5dzBCQVFVRkFBT0NBUUVBTkdBdHFNamUyL2tFUGV0WEEwQU8KZXNKME9ZeGhBYUtJQWF3WHdVUWN2QUVXK3VPODc5VUVwcHNxM1ZNWHJYOVZxWHJYWTQ3bzVCMisvTnR2U2xzN1UwRmVBL1FFdkJFZQpGdGVCTzdOeEtZN1Zhc0NDZllJN21UMExVcjNNZ0lQRG5FTnE0eW1OeUxWZ0FoeE9LNFZ1NDNtdFB6OEQreVV3SndVUGVsSVBKc1c5Cjk0djNFWEdGU044WFlveFpjV2Z1YjQxSkJUU0NjVVBFZVJsbGl6R2dUZ0ZwWmRHd3lCQkYwZjlxczd4aWVUcXNHR2lqWGRkVzIxNzgKSURRVjBsM2FiVG5oWlpXK0ZXTzVwS09Zd2tSYUxEMDkyUlZoNVdENStsZzBFem9NWEUwMGNCVWx0NitLOEpOV1FBUnhMN01ZVU1YMApjaVVVUCtYQ1NGc2lZVkhYNHc9PTwvZHM6WDUwOUNlcnRpZmljYXRlPjwvZHM6WDUwOURhdGE+PC9kczpLZXlJbmZvPjwvZHM6U2lnbmF0dXJlPjxzYW1sMnA6U3RhdHVzPjxzYW1sMnA6U3RhdHVzQ29kZSBWYWx1ZT0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnN0YXR1czpTdWNjZXNzIi8+PC9zYW1sMnA6U3RhdHVzPjxzYW1sMjpFbmNyeXB0ZWRBc3NlcnRpb24geG1sbnM6c2FtbDI9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iPjx4ZW5jOkVuY3J5cHRlZERhdGEgSWQ9Il81Y2JkYWJjZWFhMTkzZjMyNTkxOGVmYzFlZjYwODUxYiIgVHlwZT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjRWxlbWVudCIgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48eGVuYzpFbmNyeXB0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjYWVzMTI4LWNiYyIgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIi8+PGRzOktleUluZm8geG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjx4ZW5jOkVuY3J5cHRlZEtleSBJZD0iXzRmYzEyZjYwMGM2MWU5ZWU2NzUyNjkzYWIwNjMzYWMxIiBSZWNpcGllbnQ9Imh0dHBzOi8vaW50ZW5zZS1ob2xsb3dzLTYwOTEwLmhlcm9rdWFwcC5jb20iIHhtbG5zOnhlbmM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jIyI+PHhlbmM6RW5jcnlwdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1sZW5jI3JzYS1vYWVwLW1nZjFwIiB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiPjxkczpEaWdlc3RNZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjc2hhMSIgeG1sbnM6ZHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiLz48L3hlbmM6RW5jcnlwdGlvbk1ldGhvZD48ZHM6S2V5SW5mbz48ZHM6WDUwOURhdGE+PGRzOlg1MDlDZXJ0aWZpY2F0ZT5NSUlGZVRDQ0EyR2dBd0lCQWdJSkFLQUErQmRodkpoaU1BMEdDU3FHU0liM0RRRUJDd1VBTUZNeEN6QUpCZ05WQkFZVEFrSkZNUkF3CkRnWURWUVFJREFkQ1pXeG5hWFZ0TVNFd0h3WURWUVFLREJoSmJuUmxjbTVsZENCWGFXUm5hWFJ6SUZCMGVTQk1kR1F4RHpBTkJnTlYKQkFNTUJrUmhkbWxrWlRBZUZ3MHhPREF5TURZeU16RTVOREZhRncweU1EQTNNalV5TXpFNU5ERmFNRk14Q3pBSkJnTlZCQVlUQWtKRgpNUkF3RGdZRFZRUUlEQWRDWld4bmFYVnRNU0V3SHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXhEekFOCkJnTlZCQU1NQmtSaGRtbGtaVENDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFLcDc5NXptb3N0UFpveGsKZUhWcFdiV1VMU1BVczNKeHFNTGhJMjZ1UE1oK0JBc3VwdWNrSXhiUTN6OFNZOEhydmN5UmFlanM5TkhZMzg0K2FzRGsycUF1SGh1Uwo2RGRrK2dkWTVWNmNYUHBwY0JWZHZmdDdTcFlLejhuaU11OWdHY21OSjU0Mllsb0hnenFGOVU3MVdFRVJ4OGhZbzRoOW1HYjNScUkyCnloSlZjbUR0dGlJQ3FSSGF2TmtNY2g3WmtxSCtLWWNwcloxdkpaR3RiU0lDZ1J2RHpqQVQzWEw2NGhrOUhPbjN5a2NRWDgzVjFocW8KQ3NvQXQrcmR2NjBsU2ZVNWZRUXNUMi9XaW5xUVNnNE1QVUJrc0NLTU82LytuQitTTFdtak9kYytTWnBPeFowbDBZNWJuekV4b0RFaApLN3h5NEdVWnJsMUlOZHRQanh4YVV5Vy9zUWdPNVF2RWdFT2RWbHhmcEpKQlhhOWVuWElXcDhLUGJiR3BpRHBMMFpJdjFwVysyR3ZVCkEzVGZzTExSMlpBekN1SEJEYTdqRmhOaGgxWVpvTHVidmJzdnNXODUrb0NUSlJHTnFvVFJPRTNzSDdISUFJUnhaWGRvTmxtd1Zxa20KUHlUUS9CUEZXSFZzU1poUllDTTVpdmtqZjc1cG9PenhxZmhFMHBkVDZveDlLMlpBOVBpb2hUZ1NiSlNYazZBbkNZLytJOHlkaGJlYgpvM3RnRnhlaW53ODhsWEJmOExiSjBsZWh4L2tXSmZkelZkOFE3OHZzN3Y5ckt2V0t5VjVrYWNidzNxRTNFZ2hHTW5EY1FnNHRabUpPClRrL2lTODdueE9zRGNxMTVQSEswTHB2WGFzR3N2THlHN2ZkdVQvRWJmcmRKWVJVSzdOSitnZVVuMWJDeEFnTUJBQUdqVURCT01CMEcKQTFVZERnUVdCQlR4ZWkvQWR6Z2tpSUI3ZHR1U0VUZm8yUHhmY0RBZkJnTlZIU01FR0RBV2dCVHhlaS9BZHpna2lJQjdkdHVTRVRmbwoyUHhmY0RBTUJnTlZIUk1FQlRBREFRSC9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUJIMGh1WXpqZFI0MzJKc1REVEpyenlhTmJ6CjBPMm5WM3dFUmIyZXhkRDR1SmxXZnY5UlVlZmgrQnpzeTFyanNEa09FMEQwZ3RtdmpMckltODdhWStVZ0xGS0JXT2ROMVVoOGRxSkMKS0FLMnpkd3Z2L21qd0JjRWNBbi9xbm1mWGdsQUVRcWttUmlUR0RkWDlnSFJwYWpGMVVhL0JLckZUZzRvYVZwZ1BpaWdPMUZpZ3pPVgpwcU9nSVBLZW53UkRKOUZmTVp3WlZCZXBwZTdOTHArVHVUSjlGVUlTdGovYlhZVk9rYURoUURPUWhhYzZ5UDJIQmE5NEFkeFdOMGtzCjhrc2JpMWtIbEhqVld0VGVqZmVYT2JreWtlMzZTUHlWNjJFOFhuc1Fnb2RSL2V2UDErcmREcXhXRXlwK3RKaXNNRWFOYjdZcGdjMmcKSTJyZUZYc0QyY2ROTk5JQ3hXMVFrdkJLRm9nM053TzBMUDZLZmU5Y1dJQy9ndFBCS0ZZbjhSQ2FpZ1A0a0NZbC94Q3VjVFdadHAwawpRbGpMbEhRVGJ6YXpXSEpkY0hhNjNHanBNSm5XckxpU2t1QXdQdkRzNURYU0xMTTFSZjY3Q3h0TEk5RjI3Wm1lZDJBdnBmWmV6cjlvCmdpUDIrYXhmdGRrUUllektyUUpkL1FuSnNGemlJZ1oxV0NDdVFPSVlsYjNucjdVUHRRYUZvRk1LclgvNlQvWTQ1aElqYWgrakl5bXcKb1RzdmJ4eEdBMjZZNjJwOEY4U1JzaE56eCs5VklDUVdrVHh3akRjWEl2SnNHS1pwUXJOZnBFdHdrcENxV1NkL2c5Y041VURNS1cvMQpOMXMzY1hzZ212dzVBZHpvc0hQb2dVYmxPYUFwRjFUUDkxR29xZkdSZVFkSGJxQk9kZz09PC9kczpYNTA5Q2VydGlmaWNhdGU+PC9kczpYNTA5RGF0YT48L2RzOktleUluZm8+PHhlbmM6Q2lwaGVyRGF0YSB4bWxuczp4ZW5jPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGVuYyMiPjx4ZW5jOkNpcGhlclZhbHVlPlpZei9kNFBLZmR6MnhsVWRTNjFCTGJsUkd6KzJtTzRSRUl6YVJnVjBtLzB0K2o4OGhSLzNObVEzSTBpOXBOeDR5VVFnU3JZZjViaWEKQ1BMV2pJajQyRWVvZTdmS2J5MVM1cHovWkJYMkhudHJVNzB4NVVYc0x1dmNWSnVtZmZtQ0U2V0szNmZSZC9rUG55N0Z3cjhVTDM4LwpsUXhSMVROZnJZKzZQSWNubFVXcUpidEY4b05KREtJT2RtQXNJUGpjY1kwSzlzM3RZbHZibytObmZyVDh5M3pUYVluTDB6dUdhVHRVClNvZGN1SHI0bTJhQUFpWTVzRXcrakVVMmQ5Mm11clFxR3dZNWdrTmtwUXpxVTRveVFIVEpRSkZtOE84YjRmZXhMQ2p1MHRoVlN3N24KVDhhVStqMG94SCs5UlJSWXVqSjl5WCt5L25uZVp4Z2JNbWlhdURIbUQ5YlFDOVZSbXBzQjVTclB3d1gwTTZVOEwybWdhMWZvZGJqVQpCdisyQVJvWXNmZklPdHBNRHM3UDZIWk9pVVlOSzZzQ29mKy82bllpY1FOZlBXdkRWMHAyWVJGcUZFMksxanl2dHpzVTkyeHdTMlZjCkhLQlVzSGU2RWRUNlQvK2Yvb1R2UGJhc3p3MVhURWgwS211dWN1aWhWVElWT0JPMWFZM0EvM0hZdS95NnRoVHZBLzFoZUd6ZFB4Z1QKMjh0YzFYYlAvMlVubUYrYnBaYS90NTltU1pPenZVc1BkaUJYL0U3K20waGxHWHgyNCtyM2lhZ2NoTnFEN2NPdm5VZ2tUcFkzSWtRSQphQldtK3VJYnNSSm5JaXZFcDVUd2NobXQ4MnJGa1lncHo0bmVnZ2ZVaWhUekdXNkxxeDgzbmNoUGRndXBmdDNrc09YVW9pdEo4SWM9PC94ZW5jOkNpcGhlclZhbHVlPjwveGVuYzpDaXBoZXJEYXRhPjwveGVuYzpFbmNyeXB0ZWRLZXk+PC9kczpLZXlJbmZvPjx4ZW5jOkNpcGhlckRhdGEgeG1sbnM6eGVuYz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjIj48eGVuYzpDaXBoZXJWYWx1ZT5EOFNPUW1Va2tHMzQ5UEVRYXBpMjlpUlFyQk81KzAycUt3OVFoREVqc2pzbm9XaU5ydFNBNlRITU5vN1hJOVg1ODVYMUJzREZFWmM2CjBaYlhvSkFhcE9EUDNkb0RleS9tVy9uVXF1Nkt1RnVJTzV1eUlPRGttRUtCaVdUc3IrZkZzZ1Rlek84eTc3bDVOc1ZaY0JFMzdhbmcKT0NHZGhPeU9ybmFodmRSVWNvKzFMTmNGWkZwbkc0ODk5VFMxN2NiSmorZDFZeHNBNVh6MjV3UHZVamJKTjRJcUNmZmJPd1l0dDZaNAozUzR2QVZKME9jYXVYSTRUc1g3bEhYcFYzdU1IK0FHZzBCYkhCWWYxdUVIYytudExTanZOdHNSc0I4WlBCbzNVNFFOOWpBTnhjcmdIClVMRVdPa0kyTC9ZTzRmVzFaRk5QbkxaRnkyRm5GdDE4RmxoUXZVOFhxbytkUi9TS0JRNHdvSTZHQWN5NmpuZUd5a3B5UDY1TVZqZ1IKNFM1cjEreHFOcExIRVJDNHE1WHR0bDYvTkFCdTNpUXlTZkNrQ2gwbU9sSGJvbC9nRzJ6aGROTm5PREdKVS9vVFdDWUhOYXAvaUJWYgpUSFpqRXhZMXFnVjczYzE4aC92Ry85U1dOQk1oY3NzUUw3empsVys5dDVmdTkySFFadTl0WVB4UUtYTWYyQWNtTkVxOXZ5STBsUTBtCm5jaVNzYjVXRlkvRE1iUll5cnBoNkhjejQ4bXFBY21HL1h1UWFTR0VZSjRuT2dWWHZuL25lOTNnSzBFNHNyMEZDRlJIU2hDeWZOZ2wKNXk3ZklFODVYeTJZKzZ1YWZzL0dxQXdzK0xBVVFDUUdaa1dudDhoOVQwQTJrZ0lwZG1aNUNLUFdVRWhkVEIzdkJWS2hONE9rTmZnaApvUEdQUVgralZmSWQzcWJ0cTg1ZytwZ3BRbGU0cnlrM29JY3lIZ0tqajRGaFR4OHZNVXRSYzc5dG1jNVVFbVhYLzNUWFBOMzM4a0QzClB6U2l3VzFnOFg4UVhYWXlMbmNDWmlQUlBmbk5VNk43b1FWOFE5WndiN1hPMSs3OThPdE8zckptK3RWZ2NvTE5CczhLN2tCOUx4OGEKangrRGJpT0dGR2h0N25ud2FFYUlFdkw4THBlOFM4QkUwSnNwL3V1N0h0UUY0d2c3akZiVzBhTVByb0orUmxYVDBzOVZmOThEZ0RxLwpRZ0JMVUJjK0ZOMUszaEZjZUFidEhsVENQMXJGY25UKzd6WW9HTFBCU1hFSFNtRGNES1k4eDlmUVN3N0d1bnExL0d0Wkg5SHN1Wm1tCkV3VWJ1RTQvOVVQR3ovSGd2YVU4dTBETmNrN2pnUDhpc0RoRHhCS09HZUVPWVJuWmtnNkVkK2NydnJMekQ1N0F6aEJrUlJIU1Q5QTkKQXVzaTFrV2s0ME5nbHgweVU0Sy9YMi9RRjg1dDEya1p0YVkyaklXYTJZMzdKMG9wZnRrQUxEcWFEVWRJdC93SVFMcWxlSVRjc3Y3bgpsV0YwaUppUmcyeFlwSkZBL2tReEJkWWt1RW1kZit1OE5hWmJidUdHRU9rWVVoWVhVWDNxRzJ3MjhieGkzZ1ZYbzJKNTgzbmVGWTBSCmJMdkU4MHB2dUJtTXVCTUZCT0gvOC9GK3JCcndDb0RSZXF4VmZmY0dDdGNJYWJHTmZxMFdWS3g4cndsTmJLdXZmTi92Vkh4bWN6K2QKaWRsYTR1RU80aVZ1UHovTmtGMWZydXFwWDZscE9DeGRMYkp6dXVvWlh6c3M4R0RseGFBNmxtQys0V1ZMZGVBa1F5T25aRTg1WU9BRApkVG1mWmxnRXh6VHhGS1dPQUtHWlBOOHpoczVlRElwTW9xU3NNbTRuOThiQWFwZi96ZlhhcDgzZGkzaGtKZHhDRnpTUEhlVW8zVTlvCnRqaHZad3ZaSFhMQkVldVhqSEhSM2xOc0FDWkNRQmx3WnYvTmwvcll3UzlTUjlEVnRQS3RCeHZTSXVrQ2xQamF3Z0JhUzJpQWpGWTUKQmkxNTdHenlSd1VxVVhhM2JXeVBRa2JKMEk4dktiUXA1MFgzajhDWmc2Zm9vZlJrMkloZmVsRk43WnBjVldKK0FxZXRhSGZEUmdKawpCdkNXTEEyRCsrNFFXbTJMaTZXVzJlYUdodzhpUGpndCtmTDB5b0MwU2xxUko1QzJNZlpuWUdJWDFXeXFwcUhaSGZLN3JIQUdTMXR5CnJmMFU1NnJtelBxQ3NCcHBCeUpQMkxoVE1QUS85ZFl2amw5OUp2elRNL0llMy9GcU93OTZrbExheU1pRjdHNW9IZGw5Tm5DZW5wMncKTFJmaVJIK0tiMytORHR2SkpNSWpQWUxjQzVBdmQrWGVQV0Q0MXR1Tkk2Z1lCeHg5aE5TT25sN2t4MU1VeGN6azRJeFNzRktaRWFTUApCQUJmSWJZTXlSNkc1aDhjT2hYZnRTdlNLbExOaFlhemM0TVdESXZiK2F2aVltYVlMS0ZUc2NBSTFKM2tQN3k4a09yQkkyYjJaTllpCk1Id0hzNVk4MXpDSXU4VkRBVkJvRElVNWJ1WXlnaWJHS1c4ZFBCTDFVc1I2K3E1SWwxaG1mUGxJeFFMWEFUOFVsSDR3eVkycC9KVmkKS3NrTzVsM0p2U0NhYXdsQmNNMTBORnZsSGdrTlovM2ZTUEl6bEpzNEQxNDIvVkVoMVZ6MmcvSVIyNmpmRFliZndUU2lyc1YrNS8yWQp4bXAyOFBPeGdBRWE2ZTBwSjRRZm5oZ05hbFVQejhLcXhscE1GdEhpODJsS2dYWVpQMEdhOUpWVkpHZllPVG5EdUNtaU04NDdPR0s2Cmg2ak83eUhUTWtLZzh1T3prZHpXdWY2bGJlSUowdnhoelM2dzd6V3N2dVNXekZUMVR0b21nYUI3WWdyTzBsNGNZTEFWaWxuK1ZrRnUKcDA2OU5FclNNbEZ5K29UWHBwYTFvdHhPck1HdDJvVk9oL014YlZQZnNXMGpmMEpUZHVtQjFVS1ZCb3lyeXRNMVc4SFFFclVPVFFaZwpSWVhoWmM4QlIyU0wwMFUyWXBWUzZoT0tsVkRnbGdPMHBEZ05yRHB6UGFaUmlRTEJiTnZyak90eUhoT05acWM4VmFTTTRGNExRaWlqCjhqRC9tcGxuZU5QaHpJd1FDaExXR2VTekRmN1p5dExoM0lqZkQ1WGRaKzU0M1NIUWR1bGlYOXAzZHZHVVVSWFlhVlVSQUU0RU5GNG8KMUlhUnRtemtGdmRRWm5yMm5GemJoM3pQWUlHVHl1cHBrdlZHOG5RVEpPUUxwZVVmcjNCUm9DNWM1OS9LUGJuUHA5SGU0ZWNmbHAzTApZQmJpVnRaQTI3bnIwSW5XV2c3VVlDU1NIaC9rUTlDUDl2T2FVRzl6OXNGVlhGd1hlNFNWUUlnR1B5R0tOUExEd0h5S1FVMW1xWTFuCmw1NEZLcDBCbEtLck1MMVBoK0dFcmNnQ0ZsaHF5NDVxZ1VBcEJyK2RVaVpjY3MxanB4WlZKL0FhL3gwNU1uU3V4MWNUekYrRlpDK3UKR0hCaU1WVmd5ZlRQZHdodzJRbVNnTkx4aWpsWDUrTTBuekRlTUZDbHZ3d3dndGNkNjkwOUxRekhOZG5CSHdBQ1dLdi9za3ovVUpwVQpXeWVwTk5xb0Q2U3RlelhONGwxdDVsNXY3YXROY3FKNHlpZVZJMTdMNEUvWExESUJ4RkZHaVVjdDVrbHRRbTlpYm9KLzNPSm9vaXlaCmZ6QXBSQ3VlcXYyZHhtd1VtNFlDdy9ETHlaNnVaL0dRbjBXRFNncno4Vm5rMnVzS0ZNS0VlS1U4cGJLV2lyenBPSDlaaFpMRUxGVlAKdi9hcGZhQTJLeHhQdDlXbDhPWXk0OEdDTitUWVhib2xZa0VhWDZ0VUM1L1Z0WjFYQVRlV3ZPZTVXM0JzNUtyMUlyM00wbDg0L21wdQpHMzNZcnRqaldWeGNwc25ZclF2cXFKVk0wbk8xUEVxY1lWSjljNFNrQSszallNek94c3ZWUmJDUm42RmZwRHQvTXM0QTVQclVxOUorCm5LSXdlbVZRZ1prMzFzTlcrMnI3dzlWTUtFUGVldkVmaTJ1cVFZVGlhbEIraXN3T0Y2WFA0VVp4alVva1k2UEVQZldZWkFTTW5NajQKeWZsb1VGdVFqZVFlb2tvZmt1RFdBOS9oVmVTTTU4UVVSbCtJZldoNEZmZjN2d2JncU9KaU1Dc0crUUVZT1Z5aEYwQlBOc1pocllkVgpjVXdUU3FYOEdEUlNDMnR6UGk3d2NRcmdMUjBsN0QyOCt3anFKbWd0ZUFOZ2o3Qm5Tc1N3ODgzTFU2WXVkbGtiVnVSOHRScGZpd0NnCjdsTkxlSVhMWFl0KzRJRTBpZTVBRGZmTnVWNkNVeGFlZmlheWpFZFZyMHBZVlJXZ0h6RFR0dzJvVEZRMWY4eXppUDBDQWtyS1U2MVgKZTZMaGVteTlwdU0vcWxQUWZicldNQ0VsZmlVZ0hGNk55QkUyTHladVhUQkpzTG9PQlRHK1pLQjJzN2lQTmNvZkZnRDBBbCtXQ0hEUApJTUprWlZrdXZnbHNsa2J3UGFGejVuNldxNEM1cGtSSHJnbzVWMGxiNU1GdzlMU1VBOWlIdC9wNVNYZFhiZ3ZjcEN3b3dua1AvcWV1Ckx0dWdhbDJrWUxqVVB6QXFsR21ZT21YRW01SjJZUHBmMWtpZFZoK0lhNFFkK01XVGYxTzVLeTRqV0UxaTZHNGpreHhMaUJuQWE1NGsKNEJoTG5kOERUQ3pXWldpMmd4SG9oSzc5aUdpTWJ2OW1jeFJvUHU1MEJRM0RqOU5lNjUvRVgxOUE4TXlKa3F1amYyZUx0emFqcFd0bAp0a0szcnhIUHdaaElvbTh1ZElRUlJmOUNLU1ZJUFc5dUVyeWdtQS9ld3F4ei81c1dNdjZoYzFTeUZUNUQybTVqSmNLR1VDYnljUFUzCjZGZXhsbGI4L28xYmZzT3B6L1FVTUZTNEFTVHpjb29rRFhMVndJQTlPM2hwMUFUdzJObTdDMGYyZXpTNWdpb2RlWHcrdUZNU1VhbmwKcjRsRlJWQW5GYTc0MElJR3YxMkRoempsaVgzRkxGWlQ0bzY0SmdVMFR0bnR5U1ZLbm5sNWV4RWpZdGp1dVBzODh0dThJS3BsOWhMUApkVm5JUXgxbDNkRlB6bS8xZHBWRzFzSW5uVEJiMmtpaCtrcklaSzg5aWU1bXJCOWp0TUU1S29ubTFucDhjejN5S1FvMThlMFRvSlVICjVFT3BUb1lLbDBZdTFUVlVnd2FiY0hGZkRMLzR0T0pwVGxmeW9xU1JOcTI4cDRHRSsvK21QYW5sRitsT0xNeGp4cTY4cmpKWHF2RHEKNEt3TUU1WDNCSjZOcjI3dVZPNGxUZExyN050VzFMaGNzaTdwbURheS9OU1hQR3N0OEhoZFMxWUI2Wk1udXpZNUxDVGxwU1pHaXQyNwoxamFob3FNbVNOejZsc2xud0lKUHN3ODNKRWpadGxMSmJ2a0pZY3V6d3BIc3dtVUhxNHhrcTN0S2cxMld5bE9VS3VWZFNscWJNZ0hOClpKVkVRQys0QzdVTVM0UU9ubEV0SWt5UDBkMXBTNVFieWlscDQ2U29vOXVSeFNRRHJJK0FadU90azJqVjBkOGtOWUlQSkI2UnArRUsKc1Z1SGpuNU9MT0FjVHQwU2pRUWFpUU5mN2RMNDFka2xGMkdwcWtzRmFydUxiM1NXS3B3NGxzZzhiSFBKa1lQaU90N2oxY2FJZmpWZwpxc0FybXA0MWNGZXQ3SCtQV2ZxMjJjVVZubjI0YkJCL25LMmJpUzlHNFdvb2szV09mZWtOVUs1UXBzZDdJM3l6VnhSWi9jYmZXdEV1CmVsOUc5MzUzN01XQXlPb0xLbmdGM1ZIK1JtS1N1emw5UjRlWjJZa2ZOWXh0NkdJN05pblo3VDFSbkQzOWlrQkprR3ZvRVVydis1OXoKMmJIUG9nemZ2cVl3bUFpdzByaXpuWjU4eWJaRHVBMVg1MUhGYVF2c1YvZ0hmSE10NzNLMUxkL0RpVkNOSTNpaExHaUxPWDlqcWpqRgp0SE16KzN1UHR2T0JUOHRJT2x6d1EyY1IvWDU1SmErUkVTMDEzeWlRdnFrTFVJcXc0Z2R4MjJJaTUvdWhlZU54T0xEekN0d2o3U0ZyCjlVUTFVeGFtVDlWck9EU00rVDgwakJJWUxDbnVvakpldGxlZGN1cTlrcHg5TXNVTnhuaHRNYWJyUHpzWHJINkJ3MWFoNE9tR0k0MVMKOGxKdzZBM2U5UVUzRlQ5UFBtUWNPWi9HblZmcHN5OHppMWxPOUlnRUFHZlMvV3RJcThoNDZwVDNtOVVDTys2VFJWcVZMa0h6d3ZhZAorb2VXQkp5ekNKTzFkcGpGaTBuOFpEMy9HNkdsLzBnR3AwWDd1a2Rvc0xaTW5FdU5hQ1cwUlY0ZGhiaHpKSHJJWU1RLzJLS1plazJICjVuaVdXSUZ2NGpyUkNxUzF1OUtFRUdzV2tMUVBnM0VabkpsRG1iNnp4NE9OV3phTVNZWTJ3N0pxckt2UXFoYzNhRFIveWFoTk1NRGYKc0dJclVJcDdkZGl6ZnRURk9nSEhwTXF6RlcxM283M3NqM0lOTkxONk83VmdQSFFqWm8vQlhxdUJ1Q2xpZlhYYjNVS3NDTmpYYkVDUApralE2ZCsxKzhVblF0VlQyV2EyaGdEejVLM2g4RmtpOUpQMEJ1bm1vQnVEeG9qaHFISnBHTDZoOTV4S2lBNXF5TC9POGxZR0h5RWZzClJXcTJIY3lwNUtwM1Z3K3IyMHJuTlVjTVNRVk9aOEhTVjVYK0Vxc1pNZXBCcXZKajkzbjRvYllnWE96TVRWR05Fa1BLa0hlUW03bmEKSlZvRXlFa2N6UHJhZC9MaU9uNHJGdmxSVUdacklZYTJCTzdOSGhnZ09yRmp1L0w4VSt2QnFUS1ZkRWExNkFUN1BEUndJSkdUdFVXRApLMFhKdmMrTG85elRBeVN5d1NhYVV2TnhwaU1RNVBqaU5Ja3dVOG9iY2JpektRdWs0eEtDd1JOUWhsM0hpWmFjYUdDcHh0bFpUZUxLClNwVHJhS3dseWptUDRydmhNOFRHRUt5V2dBZmxrNzVZSDd0VFlWSGNiVG5CalRJNTV4aDNpaDcwWERkTFB6U3JmenNpa0hkTVNHV0MKakYvaFJvYTQ3OXhqL3p5Z21ISlhScHE4R094UEZZOEFyWUJWazgraG1oVy9UeXZZenJqVlliU3BIb0RJeGhrTVFFd2N4dHVRWWdoWgpmeHkrak9ZSVRUMVNzRlo2STQvZFMxZ1FQSUZpc28vemV1OGRWb1ZJc1hhdXoxUUhQWG55bzl6STlwRkJOT3cwM1pmQU1tZTZPblkzCnN5NDNlZ1duV3IzSWZkK1RNdmxJeTQxUHJybHlmNm02aVljcDlNVFJIU1BUQk1xTkxwT2VsZ2pUQ1VRTWhmNVRZbi9kR0twZ2IvZWoKUE1IZmZRZGxpVVZsRVpySGxKUWdsK0drVWVuUDd6OUNJak1JeXdIK3RyS2F5cGsyRG9VSXFJdmZvbitPWG9EVGFmdEEwcWVKdlYxUApGdUJSOWpvL3REak1wK1VtYlZWZENMYjBMeXA0VE1kUjdLVUY0WklLdUtGdXhJY0VnQXlFenJ5SVZWZCtmc281MHJ3Z0NRZm56ajBJCkd4SmVqTHZKQ0c5OUxxTFhDZ0Q0UG5WYnRvd3ZQN2VLS08vbTIzWTJrZ2tacTFmR29vMldkVGdMQlNyZWpiNUhXMkV0UWJHVFRJR3UKYXg5MWZpK2Q1L2NRaURaeVJDelh0YnNnQzhZZEJRVlZhSkZzbkxoR05qNVhweEJhWXdrLzdGVXlqVzFqcW5QY3VaTXVFRnUrRWc5SQpabjhycncyTjhpVzJIQS9wK2VFbXJXYWk5WEJtK1llWjNveG1veGFIOU1zRFNJWUhiR0FHeTRSUWRIWVJlUmlGYlJGaUVremtpVkZyCnduMHBuaU8zZjc4NDBQMmVWeGY4b1VvdXBpOUtCNmJPOElUWm5IWm1wblo2cXdRUmRyWjE4Z3YwV1E1V2pleWdXVkRlcjVXTE90U3QKeW9YbTltZnVJNGxBcWhpR1FrODdxTnZOSGxtQzZCUVpBSWxXTWdMSmFWL1NjbG51ejVxVmlobmZJNnR1Szdla0tFak9Xa2xwSy9xbQo5ZThkZWtXYURqTmZLamN5RGNxYVNtUFFqRnNQQ0pYWFBXMnZwT3dycWxjVWdybXQzS0d6dlBsUjVHcytiSnd6L3pPT0RlcVBpNDFDCldSais1dkxWSGI3Wk1GYW5xVko3a2RvTFVxVzF6bnZSOWJjVnVrdWI4aGZGTFFJQlZpcmxJZVRDaG43azlsYU9oSStTVUdvSWlZUEIKZ2hCZGFMcmkwODExSm5hUU9tdnZFY3V6QllzV0UxWk1udXhJcHp3a2JtVDBSV3JvZkJNaURPTUVDb2EraTFxd1A5TmxneWllZHp2UQpyVTZRMzk1dXFUTG1pYXNiSk5EZGdVUHUyMHBEaHRsak9uUDBUZWhxWmxGTWphU2JSRGVieHlTbjNtMXMzM05tTlpQQldJQ2ExU1VnCmhPdVh6NUIxWXRwbktiYmJWVHFDaEoyQVpMczdUSE02SUNyQ09HRTJCNXJiZWJKdkZkQ2hiRjczcENBdUwzRWphUk44aVRUSXVSVUEKa2V3MmtlRTBpbDk1QmhqRlFYSkJWbUhpRTAxMWNlOGt0V1VPWUZScHF2UDF2cHdxZW1wZk1wQ1RQT1JwLzVYSXdMek1WMXRUVUNzawprZEYvZTZ2MGZ3a05pVWhiaVlDQnlCYUVQMW9xNXJKNEwrWE5XZFRjSVZIL0R1ZTE4OVlJbFVUR2tGK2ZpU0wxOVM3bUtsSklrdDhQCmFjaWUzc1J4UnlQeWt5OVA0WEZoTlJIY1J6QURaUEhoN09IR29RN0x2WDBjU01oT29LU1J1UGlOSDlMWjh1Yll6NGtSbnhjT1NpWFYKT2pDTGNYaHcvTEtYSVlQZFQ5Y2FPdExzZHM5TzU0OHhjSGJmWm9adHowc2FoWHZQaVZBbnI0eVBxUXY1aFBqSk9qMnBlQVdiRWdOKwplK1R6N3pBNmNMYld3YjJMNWF3YVNEbmdpbU4rdjQvS0d6dzdpZkJtZjR1VFpkOEhKYlJtWTdxU004T0FVaVowREpzcUN1Znl1WU0xCjdYLzNRVFgvYXUwUmd3OXl3RlVvbzZQM2xDa1hhbWloanp6VWRjMWtCc0F0SEdDZzY1dS9rMDQ2dFlsM3dJNGdpZHcwdnRWTE1YNVgKMHJTWU1LbDBTYm1mdENKM1FPd3dsbnRlU3p3MG1oaWpaS0FJTFZyd0pCdm8zVjR5NWhiemk0MTJGVEdxcFhKSHhtcmxNeXpNNjhTQgphWGNEQ1ZrRzZ5Q2xmc1ZqR3BraXhKb0treWVGODNhSmJBdFNRTmRnN25USmNXTWRodUF5NGp5SDFMRjhKM1hSbTFlZEdJcUE2Mi9PCjhQRVU1RGZzb2tHY2hKSi90NnZrMWxRYzwveGVuYzpDaXBoZXJWYWx1ZT48L3hlbmM6Q2lwaGVyRGF0YT48L3hlbmM6RW5jcnlwdGVkRGF0YT48L3NhbWwyOkVuY3J5cHRlZEFzc2VydGlvbj48L3NhbWwycDpSZXNwb25zZT4=', 'base64').toString();

console.log(res)


let validateSignature = function (fullXml, currentNode, certs) {
  var self = this;
  var xpathSigQuery = ".//*[local-name(.)='Signature' and " +
                      "namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']";
  var signatures = xpath(currentNode, xpathSigQuery);
  // This function is expecting to validate exactly one signature, so if we find more or fewer
  //   than that, reject.
  if (signatures.length != 1)
    return false;
  var signature = signatures[0];
  //console.log(signature.toString())
  return certs.some(function (certToCheck) {
    return validateSignatureForCert(signature, certToCheck, fullXml, currentNode);
  });
};

// This function checks that the |signature| is signed with a given |cert|.
let validateSignatureForCert = function (signature, cert, fullXml, currentNode) {
  var self = this;
  var sig = new xmlCrypto.SignedXml();
  sig.keyInfoProvider = {
    getKeyInfo: function (key) {
      return "<X509Data></X509Data>";
    },
    getKey: function (keyInfo) {
      //return self.certToPEM(cert);
      //console.log(cert)
      return cert
    }
  };
  //sig.keyInfoProvider = new FileKeyInfo("./metadata.associatie.kuleuven.be.crt")
  sig.loadSignature(signature);
  // We expect each signature to contain exactly one reference to the top level of the xml we
  //   are validating, so if we see anything else, reject.
  if (sig.references.length != 1 )
    return false;
  var refUri = sig.references[0].uri;
  var refId = (refUri[0] === '#') ? refUri.substring(1) : refUri;
  // If we can't find the reference at the top level, reject
  var idAttribute = currentNode.getAttribute('ID') ? 'ID' : 'Id';
  if (currentNode.getAttribute(idAttribute) != refId)
    return false;
  // If we find any extra referenced nodes, reject.  (xml-crypto only verifies one digest, so
  //   multiple candidate references is bad news)
  var totalReferencedNodes = xpath(currentNode.ownerDocument,
                                  "//*[@" + idAttribute + "='" + refId + "']");
  if (totalReferencedNodes.length > 1)
    return false;
  console.log("checking signature....")
  var ok = sig.checkSignature(fullXml);
  console.log(sig.validationErrors)
  return ok;
};


var xml = fs.readFileSync('response.xml').toString();

var doc = new xmldom.DOMParser({}).parseFromString(xml);
var elements;
elements = doc.getElementsByTagName('ds:SignatureValue');
for (var i = 0; i < elements.length; i++) {
  elements[i].childNodes[0].textContent = elements[i].childNodes[0].textContent.replace(/\s+/g, '')
  //console.log(elements[i].childNodes[0].textContent)
}
elements = doc.getElementsByTagName('ds:X509Certificate');
for (var i = 0; i < elements.length; i++) {
  elements[i].childNodes[0].textContent = elements[i].childNodes[0].textContent.replace(/\s+/g, '')
  //console.log(elements[i].childNodes[0].textContent)
}
elements = doc.getElementsByTagName('xenc:CipherValue');
for (var i = 0; i < elements.length; i++) {
  elements[i].childNodes[0].textContent = elements[i].childNodes[0].textContent.replace(/\s+/g, '')
  //console.log(elements[i].childNodes[0].textContent)
}

xml = new xmldom.XMLSerializer().serializeToString(doc)
fs.writeFileSync('response2.xml', xml)


var certs = [
  fs.readFileSync('metadata.associatie.kuleuven.be.crt').toString(),
]

validateSignature(xml, doc.documentElement, certs)
